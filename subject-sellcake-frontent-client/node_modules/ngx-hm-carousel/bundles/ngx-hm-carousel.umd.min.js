!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("resize-observer-polyfill"),require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/core"),require("@angular/forms")):"function"==typeof define&&define.amd?define("ngx-hm-carousel",["exports","resize-observer-polyfill","rxjs","rxjs/operators","@angular/common","@angular/core","@angular/forms"],e):e(t["ngx-hm-carousel"]={},t["resize-observer-polyfill"],t.rxjs,t.rxjs.operators,t.ng.common,t.ng.core,t.ng.forms)}(this,function(t,r,o,a,i,e,n){"use strict";r=r&&r.hasOwnProperty("default")?r["default"]:r;var s=function(){function t(t,e){this._view=t,this._template=e,this.compelete=!1,this._view.clear()}return Object.defineProperty(t.prototype,"currentI",{set:function(t){if(!this.compelete){var e=t+1,n=t-1;0!==this.index&&this.index!==this.length-1&&this.index!==e&&this.index!==n&&this.index!==t||(this._view.createEmbeddedView(this._template),this.compelete=!0)}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Directive,args:[{selector:"[ngxHmCarouselDynamic]"}]}],t.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.TemplateRef}]},t.propDecorators={index:[{type:e.Input,args:["ngxHmCarouselDynamic"]}],length:[{type:e.Input,args:["ngxHmCarouselDynamicLength"]}],currentI:[{type:e.Input,args:["ngxHmCarouselDynamicIndex"]}]},t}(),l=function(){function t(){}return t.decorators=[{type:e.Directive,args:[{selector:"[ngx-hm-carousel-item]"}]}],t.ctorParameters=function(){return[]},t}();function u(t,e,n){var i;return void 0===n&&(n=200),o.Observable.create(function(n){(i=new r(function(t,e){n.next(i)})).observe(t)}).pipe(a.debounceTime(n),a.tap(function(){e()}),a.finalize(function(){i.unobserve(t),i.disconnect()}))}var h=function(){function t(t,e,n,i,r){var s=this;this.platformId=t,this._document=e,this._renderer=n,this._zone=i,this._cd=r,this.aniTime=400,this.aniClass="transition",this.aniClassAuto=this.aniClass,this.align="center",this.notDrag=!1,this.mourseEnable=!1,this.delay=8e3,this.direction="right",this.scrollNum=1,this.isDragMany=!1,this.breakpoint=[],this.leaveObs$=o.merge(o.fromEvent(this._document,"mouseup"),o.fromEvent(this._document,"touchend")).pipe(a.tap(function(t){s.grabbing=!1,t.stopPropagation(),t.preventDefault()})),this.isFromAuto=!0,this.isAutoNum=!1,this.mouseOnContainer=!1,this.alignDistance=0,this.elmWidth=0,this.infiniteElmRefs=[],this.restart=new o.BehaviorSubject(null),this.speedChange=new o.BehaviorSubject(5e3),this.stopEvent=new o.Subject,this.destroy$=new o.Subject,this._porgressWidth=0,this._currentIndex=0,this._showNum=1,this._autoplay=!1,this._infinite=!1,this._tmpInfinite=!1,this._grabbing=!1,this.panCount=0,this._disableDrag=!1,this.hasInitWriteValue=!1,this.onChange=function(t){},this.onTouched=function(){}}return Object.defineProperty(t.prototype,"disableDrag",{get:function(){return this._disableDrag},set:function(t){this.rootElm&&this._disableDrag!==t&&(t?this.destoryHammer():this.hammer=this.bindHammer()),this._disableDrag=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"infinite",{get:function(){return this._infinite},set:function(t){var e=this;this._infinite=t,this.infiniteElmRefs.forEach(function(t){e.addStyle(t.rootNodes[0],{visibility:e.runLoop?"visible":"hidden"})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this.speedChange.value},set:function(t){var e=this;this._zone.runOutsideAngular(function(){e.speedChange.next(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showNum",{get:function(){return this._showNum},set:function(t){"auto"===t?this.isAutoNum=!0:(this._showNum=+t,this.rootElm&&(this.setViewWidth(),this.reSetAlignDistance()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoplay",{get:function(){return this._autoplay},set:function(t){var e=this;i.isPlatformBrowser(this.platformId)&&this.elms&&(this.progressWidth=0,t?this._zone.runOutsideAngular(function(){e.doNextSub$=e.doNext.subscribe()}):this.doNextSub$&&this.doNextSub$.unsubscribe()),this._autoplay=t,this.infinite=t?(this._tmpInfinite=this.infinite,!0):this._tmpInfinite},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentIndex",{get:function(){return this._currentIndex},set:function(t){var e=this;if(this.currentIndex!==t){if(!(this.runLoop||0<=t&&t<=this.itemElms.length-1))return;this._currentIndex=t,this.elms&&(this.autoplay&&!this.isFromAuto&&this._zone.runOutsideAngular(function(){e.stopEvent.next(),e.callRestart()}),this.drawView(this.currentIndex,this.hasInitWriteValue),this.isDragMany&&(this.hasInitWriteValue=!0)),0<=this.currentIndex&&this.currentIndex<=this.itemElms.length-1&&this._zone.run(function(){e.onChange(e.currentIndex),e._cd.detectChanges()})}this.isFromAuto=!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progressWidth",{get:function(){return this._porgressWidth},set:function(t){this.progressElm!==undefined&&this.autoplay&&(this._porgressWidth=t,this._renderer.setStyle(this.progressContainerElm.nativeElement.children[0],"width",this.progressWidth+"%"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{get:function(){return this._grabbing},set:function(t){var e=this;this._grabbing!==t&&this._zone.run(function(){(e._grabbing=t)?e._renderer.addClass(e.containerElm,"grabbing"):(e.panCount=0,e.callRestart(),e._renderer.removeClass(e.containerElm,"grabbing")),e._cd.detectChanges()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{set:function(t){i.isPlatformBrowser(this.platformId)?this._renderer.setStyle(this.containerElm,"transform","translateX("+t+"px)"):this._renderer.setStyle(this.containerElm,"transform","translateX("+t+"%)")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRightIndex",{get:function(){var t=0;switch(this.align){case"left":t=0;break;case"center":case"right":t=this.showNum-1}return this.itemElms.length-1-this._showNum+1+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"runLoop",{get:function(){return this.autoplay||this.infinite},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthOne",{get:function(){return 1===this.itemElms.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootElmWidth",{get:function(){return i.isPlatformBrowser(this.platformId)?this.rootElm.getBoundingClientRect().width:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerElmWidth",{set:function(t){this.setStyle(this.containerElm,"width",t)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this.rootElm=this.container.nativeElement,this.containerElm=this.rootElm.children[0],this.init(),o.forkJoin(this.bindClick(),this.itemElms.changes.pipe(a.tap(function(){t.currentIndex>t.itemElms.length-1&&setTimeout(function(){t.currentIndex=t.itemElms.length-1},0),t.destroy(),t.removeInfiniteElm(),t.init(),t.progressWidth=0}),a.tap(function(){return t._cd.detectChanges()})),u(this.rootElm,function(){return t.containerResize()})).pipe(a.takeUntil(this.destroy$)).subscribe()},t.prototype.ngOnDestroy=function(){this.destroy(),this.destroy$.next(),this.destroy$.unsubscribe()},t.prototype.writeValue=function(t){(t||0===t)&&(this.currentIndex=t,this.hasInitWriteValue=!0)},t.prototype.registerOnChange=function(t){this.onChange=t},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.init=function(){this.initVariable(),this.setViewWidth(!0),this.reSetAlignDistance(),this.disableDrag||(this.hammer=this.bindHammer()),this.drawView(this.currentIndex,!1),i.isPlatformBrowser(this.platformId)&&this.runLoop&&this.addInfiniteElm()},t.prototype.destroy=function(){this.destoryHammer(),this.autoplay&&this.doNextSub$.unsubscribe()},t.prototype.destoryHammer=function(){this.hammer&&this.hammer.destroy()},t.prototype.addInfiniteElm=function(){for(var t=1;t<=this.showNum;t++){var e=this.infiniteContainer.createEmbeddedView(this.contentContent,{$implicit:this.data[this.itemElms.length-t],index:this.itemElms.length-t});this.addStyle(e.rootNodes[0],{position:"absolute",transform:"translateX(-"+100*t+"%)",visibility:this.runLoop?"visible":"hidden"}),this.setStyle(e.rootNodes[0],"width",this.elmWidth);var n=this.infiniteContainer.createEmbeddedView(this.contentContent,{$implicit:this.data[t-1],index:t-1});this.addStyle(n.rootNodes[0],{position:"absolute",right:0,top:0,transform:"translateX("+100*t+"%)",visibility:this.runLoop?"visible":"hidden"}),this.setStyle(n.rootNodes[0],"width",this.elmWidth),e.detectChanges(),n.detectChanges(),this.infiniteElmRefs.push(e),this.infiniteElmRefs.push(n)}},t.prototype.removeInfiniteElm=function(){this.infiniteElmRefs.forEach(function(t){t.detach(),t.destroy()}),this.infiniteContainer&&this.infiniteContainer.clear(),this.infiniteElmRefs=[]},t.prototype.containerResize=function(){this.setViewWidth(),this.reSetAlignDistance(),"center"!==this.align&&this.showNum>=this.elms.length&&(this.currentIndex=0),this.drawView(this.currentIndex,!1)},t.prototype.initVariable=function(){var n=this;this._zone.runOutsideAngular(function(){n.elms=n.itemElms.toArray().map(function(t){return t.nativeElement});var t=n.restart.asObservable(),e=n.stopEvent.asObservable();n.mourseEnable&&(t=o.merge(t,o.fromEvent(n.containerElm,"mouseleave").pipe(a.filter(function(){return!n.grabbing}),a.tap(function(){return n.mouseOnContainer=!1}))),e=o.merge(e,o.fromEvent(n.containerElm,"mouseover").pipe(a.tap(function(){return n.mouseOnContainer=!0})))),n.doNext=t.pipe(a.switchMap(function(){return n.speedChange}),a.switchMap(function(){return o.timer(n.delay).pipe(a.switchMap(function(){return n.runProgress(20)}),a.tap(function(){n.isFromAuto=!0,"left"===n.direction?n.currentIndex-=n.scrollNum:n.currentIndex+=n.scrollNum}),a.takeUntil(e.pipe(a.tap(function(){return n.progressWidth=0}))))})),n.autoplay&&(n.doNextSub$=n.doNext.subscribe())})},t.prototype.reSetAlignDistance=function(){switch(this.align){case"center":this.alignDistance=(this.rootElmWidth-this.elmWidth)/2;break;case"left":this.alignDistance=0;break;case"right":this.alignDistance=this.rootElmWidth-this.elmWidth}},t.prototype.setViewWidth=function(t){var e=this;this.isAutoNum&&(this._showNum=this.getAutoNum()),this._renderer.addClass(this.containerElm,"grab"),t&&this._renderer.addClass(this.containerElm,"ngx-hm-carousel-display-npwrap"),this.elmWidth=this.rootElmWidth/this._showNum,this._renderer.removeClass(this.containerElm,"ngx-hm-carousel-display-npwrap"),this.containerElmWidth=this.elmWidth*this.elms.length,this._renderer.setStyle(this.containerElm,"position","relative"),this.infiniteElmRefs.forEach(function(t){e.setStyle(t.rootNodes[0],"width",e.elmWidth)}),this.elms.forEach(function(t){e.setStyle(t,"width",e.elmWidth)})},t.prototype.bindHammer=function(){var r=this;return i.isPlatformBrowser(this.platformId)?this._zone.runOutsideAngular(function(){var t=new Hammer(r.containerElm);return t.get("pan").set({direction:Hammer.DIRECTION_HORIZONTAL}),t.on("panleft panright panend pancancel",function(t){if(!r.lengthOne)switch(r.removeContainerTransition(),r.autoplay&&r._zone.runOutsideAngular(function(){r.stopEvent.next()}),t.type){case"panleft":case"panright":if(r.panCount++,r.panCount<2)return;if(r.grabbing=!0,"center"!==r.align&&r.showNum>=r.elms.length)return void r.hammer.stop(!0);if(!r.runLoop&&r.outOfBound(t.type)&&(t.deltaX*=.2),r.notDrag||(r.left=-r.currentIndex*r.elmWidth+r.alignDistance+t.deltaX),!r.isDragMany&&Math.abs(t.deltaX)>.5*r.elmWidth)return 0<t.deltaX?r.currentIndex-=r.scrollNum:r.currentIndex+=r.scrollNum,void r.hammer.stop(!0);break;case"pancancel":r.drawView(r.currentIndex);break;case"panend":if(Math.abs(t.deltaX)>.15*r.elmWidth){var e=r.isDragMany?Math.ceil(Math.abs(t.deltaX)/r.elmWidth):r.scrollNum,n=r.currentIndex-e,i=r.currentIndex+e;0<t.deltaX?(!r.runLoop&&n<0&&(n=0,r.drawView(0)),r.currentIndex=n):(!r.runLoop&&i>r.maxRightIndex&&(i=r.maxRightIndex,r.drawView(i)),r.currentIndex=i);break}r.drawView(r.currentIndex)}}),t}):null},t.prototype.bindClick=function(){var t=this;return this.btnNext&&this.btnPrev?o.forkJoin(o.fromEvent(this.btnNext.nativeElement,"click").pipe(a.tap(function(){return t.currentIndex++})),o.fromEvent(this.btnPrev.nativeElement,"click").pipe(a.tap(function(){return t.currentIndex--}))):o.of(null)},t.prototype.callRestart=function(){var t=this;!this.autoplay||this.mouseOnContainer||this.grabbing||this._zone.runOutsideAngular(function(){t.restart.next(null)})},t.prototype.drawView=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=this.isFromAuto),1<this.elms.length?(this.removeContainerTransition(),this.left=-(t*this.elmWidth-this.alignDistance),e&&(n?this._renderer.addClass(this.containerElm,this.aniClassAuto):this._renderer.addClass(this.containerElm,this.aniClass),this.infiniteHandler(t))):this.left=this.alignDistance},t.prototype.removeContainerTransition=function(){this._renderer.removeClass(this.containerElm,this.aniClass),this._renderer.removeClass(this.containerElm,this.aniClassAuto)},t.prototype.infiniteHandler=function(t){var e=this;if(this.runLoop){var n=0;if(n=t<0?-1:n,0!==(n=t>this.itemElms.length-1?1:n)){switch(n){case-1:this._currentIndex=(this.itemElms.length+t)%this.itemElms.length;break;case 1:this._currentIndex=t%this.itemElms.length}var i=this.isFromAuto;this.saveTimeOut&&this.saveTimeOut.unsubscribe(),this.saveTimeOut=o.timer(this.aniTime).pipe(a.switchMap(function(){return e.aniTime===e.speed?(e.removeContainerTransition(),e.left=-(e._currentIndex-n)*e.elmWidth+e.alignDistance,o.timer(50).pipe(a.tap(function(){e.drawView(e.currentIndex,e.hasInitWriteValue,i)}))):(e.drawView(e.currentIndex,!1),o.of(null))}),a.takeUntil(this.stopEvent)).subscribe()}}},t.prototype.outOfBound=function(t){switch(t){case"panleft":return this.currentIndex>=this.maxRightIndex;case"panright":return this.currentIndex<=0}},t.prototype.runProgress=function(t){var i=this;return this._zone.runOutsideAngular(function(){var e=i.speed/t,n=100/i.speed*t;return o.interval(t).pipe(a.tap(function(t){i.progressWidth=t%e*n}),a.bufferCount(Math.round(e),0))})},t.prototype.getAutoNum=function(){var e=this.rootElmWidth;if(0<this.breakpoint.length){var t=this.breakpoint.find(function(t){return t.width>=e});return t?t.number:this.breakpoint[this.breakpoint.length-1].number}return 300<e?Math.floor(3+e/200):3},t.prototype.addStyle=function(n,i){var r=this;i&&Object.keys(i).forEach(function(t){var e=i[t];r._renderer.setStyle(n,t,e)})},t.prototype.setStyle=function(t,e,n){i.isPlatformBrowser(this.platformId)?this._renderer.setStyle(t,e,n+"px"):this._renderer.setStyle(t,e,n+"%")},t.decorators=[{type:e.Component,args:[{selector:"ngx-hm-carousel",template:'<div #containerElm class="carousel">\n  \x3c!-- main content --\x3e\n  <ng-content select="[ngx-hm-carousel-container]"></ng-content>\n  \x3c!-- left --\x3e\n  <div #prev *ngIf="contentPrev"\n    class="direction left">\n    <ng-container *ngTemplateOutlet="contentPrev"></ng-container>\n  </div>\n  \x3c!--  right --\x3e\n  <div #next *ngIf="contentNext"\n    class="direction right">\n    <ng-container *ngTemplateOutlet="contentNext"></ng-container>\n  </div>\n  \x3c!-- indicators --\x3e\n  <ul class="indicators" *ngIf="dotElm">\n    <li\n      *ngFor="let dot of itemElms; let i = index;"\n      (click)="currentIndex = i">\n      <ng-container\n        *ngTemplateOutlet="dotElm, context: {\n          $implicit: {\n            index : i,\n            currentIndex : currentIndex\n          }\n        }">\n      </ng-container>\n    </li>\n  </ul>\n  \x3c!-- progress --\x3e\n  <div *ngIf="progressElm && autoplay" #progress>\n    <ng-container\n      *ngTemplateOutlet="progressElm">\n    </ng-container>\n  </div>\n\n  <div class="mask" *ngIf="grabbing">\n    <ng-container *ngIf="leaveObs$ | async"></ng-container>\n  </div>\n</div>\n',providers:[{provide:n.NG_VALUE_ACCESSOR,useExisting:e.forwardRef(function(){return t}),multi:!0}],changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;height:100%}.ngx-hm-carousel-display-npwrap{display:flex!important;flex-wrap:nowrap!important;flex-direction:row!important;overflow:hidden!important}.carousel{overflow:hidden;position:relative;width:100%;height:100%}.carousel ul.indicators{list-style:none;bottom:1rem;left:0;margin:0;padding:0;position:absolute;text-align:center;width:100%}.carousel ul.indicators li{cursor:pointer;display:inline-block;position:relative;padding:.5rem}.carousel .direction{position:absolute;height:100%;cursor:pointer;display:flex;align-items:center;justify-content:center;top:0}.carousel .direction.left{left:0}.carousel .direction.right{position:absolute;right:0}.grab{cursor:-webkit-grab;cursor:grab}.grabbing{cursor:-webkit-grabbing;cursor:grabbing}.mask{position:absolute;left:0;top:0;right:0;bottom:0}"]}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]},{type:undefined,decorators:[{type:e.Inject,args:[i.DOCUMENT]}]},{type:e.Renderer2},{type:e.NgZone},{type:e.ChangeDetectorRef}]},t.propDecorators={container:[{type:e.ViewChild,args:["containerElm"]}],btnPrev:[{type:e.ViewChild,args:["prev"]}],btnNext:[{type:e.ViewChild,args:["next"]}],progressContainerElm:[{type:e.ViewChild,args:["progress"]}],itemElms:[{type:e.ContentChildren,args:[l,{read:e.ElementRef}]}],contentPrev:[{type:e.ContentChild,args:["carouselPrev"]}],contentNext:[{type:e.ContentChild,args:["carouselNext"]}],dotElm:[{type:e.ContentChild,args:["carouselDot"]}],progressElm:[{type:e.ContentChild,args:["carouselProgress"]}],infiniteContainer:[{type:e.ContentChild,args:["infiniteContainer",{read:e.ViewContainerRef}]}],contentContent:[{type:e.ContentChild,args:["carouselContent"]}],data:[{type:e.Input}],aniTime:[{type:e.Input}],aniClass:[{type:e.Input}],aniClassAuto:[{type:e.Input}],align:[{type:e.Input}],notDrag:[{type:e.Input,args:["not-follow-pan"]}],mourseEnable:[{type:e.Input,args:["mourse-enable"]}],delay:[{type:e.Input,args:["between-delay"]}],direction:[{type:e.Input,args:["autoplay-direction"]}],scrollNum:[{type:e.Input,args:["scroll-num"]}],isDragMany:[{type:e.Input,args:["drag-many"]}],breakpoint:[{type:e.Input}],disableDrag:[{type:e.Input,args:["disable-drag"]}],infinite:[{type:e.Input,args:["infinite"]}],speed:[{type:e.Input,args:["autoplay-speed"]}],showNum:[{type:e.Input,args:["show-num"]}],autoplay:[{type:e.Input,args:["autoplay"]}]},t}(),c=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[i.CommonModule,n.FormsModule],declarations:[h,s,l],exports:[h,s,l]}]}],t}();t.NgxHmCarouselDynamicDirective=s,t.NgxHmCarouselComponent=h,t.NgxHmCarouselModule=c,t.resizeObservable=u,t.ɵa=l,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-hm-carousel.umd.min.js.map